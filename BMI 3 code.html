<pre><font color="#007f69">globals</font><font color="#000000"> [<br />  infinity         </font><font color="#5a5a5a">; used to represent the distance between two turtles with no path between them</font><font color="#000000"><br />  average-path-length-of-lattice       </font><font color="#5a5a5a">; average path length of the initial lattice</font><font color="#000000"><br />  average-path-length                  </font><font color="#5a5a5a">; average path length in the current network</font><font color="#000000"><br />  clustering-coefficient-of-lattice    </font><font color="#5a5a5a">; the clustering coefficient of the initial lattice</font><font color="#000000"><br />  clustering-coefficient               </font><font color="#5a5a5a">; the clustering coefficient of the current network (avg. across nodes)</font><font color="#000000"><br />  number-rewired                       </font><font color="#5a5a5a">; number of edges that have been rewired</font><font color="#000000"><br />  rewire-all?<br />  total-mean-bmi                       </font><font color="#5a5a5a">; mean BMI of the network</font><font color="#000000"><br />  iteration                            </font><font color="#5a5a5a">; iteration variable for sequential simulations</font><font color="#000000"><br />]<br /><br /></font><font color="#007f69">turtles-own</font><font color="#000000"> [<br />  distance-from-other-turtles </font><font color="#5a5a5a">; list of distances of this node from other turtles</font><font color="#000000"><br />  my-clustering-coefficient   </font><font color="#5a5a5a">; the current clustering coefficient of this node</font><font color="#000000"><br />  bmi                         </font><font color="#5a5a5a">; bmi value </font><font color="#000000"><br />]<br /><br /></font><font color="#007f69">links-own</font><font color="#000000"> [<br />  rewired? </font><font color="#5a5a5a">; keeps track of whether the link has been rewired or not</font><font color="#000000"><br />]<br /><br /></font><font color="#007f69">to</font><font color="#000000"> setup<br />  </font><font color="#0000aa">clear-all</font><font color="#000000"><br />  </font><font color="#0000aa">reset-ticks</font><font color="#000000"><br />  <br />  </font><font color="#5a5a5a">; set the global variables</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> infinity </font><font color="#963700">99999</font><font color="#000000">      </font><font color="#5a5a5a">; this is an arbitrary choice for a large number</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> number-rewired </font><font color="#963700">0</font><font color="#000000">    </font><font color="#5a5a5a">; initial count of rewired edges</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> iteration </font><font color="#963700">1</font><font color="#000000">         </font><font color="#5a5a5a">; initial iteration</font><font color="#000000"><br /><br />  </font><font color="#0000aa">set-default-shape</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">create-turtles</font><font color="#000000"> num-nodes [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">gray</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ]<br />  </font><font color="#0000aa">layout-circle</font><font color="#000000"> (</font><font color="#660096">sort</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">) </font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br /><br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">links</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">gray</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ]<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">gray</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ]<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> bmi </font><font color="#963700">15</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-gamma</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> </font><font color="#963700">0.25</font><font color="#000000">] </font><font color="#5a5a5a">; initial BMIs with 15 + Gamma (3, 0.25) distribution</font><font color="#000000"><br /><br />  </font><font color="#5a5a5a">; Create the initial lattice</font><font color="#000000"><br />  wire-lattice<br />  rewire-all<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">; used to reset the model before the next iteration, while preserving the data from previous runs (otherwise, clear-all command erase it)</font><font color="#000000"><br /></font><font color="#007f69">to</font><font color="#000000"> reset <br />  </font><font color="#0000aa">cp</font><font color="#000000"><br />  </font><font color="#0000aa">clear-output</font><font color="#000000"><br />  </font><font color="#0000aa">ct</font><font color="#000000"><br />  </font><font color="#0000aa">clear-links</font><font color="#000000"><br />  </font><font color="#0000aa">reset-ticks</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> number-rewired </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">set-default-shape</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">create-turtles</font><font color="#000000"> num-nodes [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">gray</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ]<br />  </font><font color="#0000aa">layout-circle</font><font color="#000000"> (</font><font color="#660096">sort</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">) </font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">links</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">gray</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ]<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">gray</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> ]<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> bmi </font><font color="#963700">15</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-gamma</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> </font><font color="#963700">0.25</font><font color="#000000">] <br />  wire-lattice<br />  </font><font color="#0000aa">set</font><font color="#000000"> iteration iteration </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#5a5a5a">; proceeding to the next iteration</font><font color="#000000"><br />  rewire-all<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">; running 10 sequential simulations for one condition</font><font color="#000000"><br /></font><font color="#007f69">to</font><font color="#000000"> go-whole<br />  </font><font color="#0000aa">repeat</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"> [<br />    </font><font color="#0000aa">while</font><font color="#000000"> [</font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">200</font><font color="#000000">] [run-simulation]<br />    </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">200</font><font color="#000000"> [reset]<br />  ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">; main algorithm for calculations </font><font color="#000000"><br /></font><font color="#007f69">to</font><font color="#000000"> run-simulation<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [<br />    </font><font color="#0000aa">let</font><font color="#000000"> bmi-mean </font><font color="#660096">mean</font><font color="#000000"> [bmi] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">link-neighbors</font><font color="#000000">                                                                                </font><font color="#5a5a5a">; evaluate the BMI mean of neighbor (connected) agents</font><font color="#000000"><br />    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000"> (bmi-mean </font><font color="#660096">-</font><font color="#000000"> bmi) </font><font color="#660096">&gt;</font><font color="#000000"> sat-r) </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000"> (bmi-mean </font><font color="#660096">-</font><font color="#000000"> bmi) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.1</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (bmi-mean </font><font color="#660096">&gt;</font><font color="#000000"> bmi) [</font><font color="#0000aa">set</font><font color="#000000"> bmi bmi </font><font color="#660096">+</font><font color="#000000"> (bmi-mean </font><font color="#660096">-</font><font color="#000000"> bmi)] </font><font color="#5a5a5a">; positive change in BMI of an agent by the difference in means</font><font color="#000000"><br />    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000"> (bmi-mean </font><font color="#660096">-</font><font color="#000000"> bmi) </font><font color="#660096">&gt;</font><font color="#000000"> sat-r) </font><font color="#660096">and</font><font color="#000000"> (bmi-mean </font><font color="#660096">&gt;</font><font color="#000000"> bmi) [</font><font color="#0000aa">set</font><font color="#000000"> bmi bmi </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">0.1</font><font color="#000000">]                                               </font><font color="#5a5a5a">; positive change in BMI of an agent by 0.1</font><font color="#000000"><br />    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000"> (bmi-mean </font><font color="#660096">-</font><font color="#000000"> bmi) </font><font color="#660096">&gt;</font><font color="#000000"> sat-r) </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000"> (bmi-mean </font><font color="#660096">-</font><font color="#000000"> bmi) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.1</font><font color="#000000">) </font><font color="#660096">and</font><font color="#000000"> (bmi-mean </font><font color="#660096">&lt;</font><font color="#000000"> bmi) [</font><font color="#0000aa">set</font><font color="#000000"> bmi bmi </font><font color="#660096">-</font><font color="#000000"> (bmi-mean </font><font color="#660096">-</font><font color="#000000"> bmi)] </font><font color="#5a5a5a">; negative change in BMI of an agent by the difference in means</font><font color="#000000"><br />    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">abs</font><font color="#000000"> (bmi-mean </font><font color="#660096">-</font><font color="#000000"> bmi) </font><font color="#660096">&gt;</font><font color="#000000"> sat-r) </font><font color="#660096">and</font><font color="#000000"> (bmi-mean </font><font color="#660096">&lt;</font><font color="#000000"> bmi) [</font><font color="#0000aa">set</font><font color="#000000"> bmi bmi </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">0.1</font><font color="#000000">]                                               </font><font color="#5a5a5a">; negative change in BMI of an agent by 0.1</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> total-mean-bmi </font><font color="#660096">mean</font><font color="#000000"> [bmi-mean] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">                                                                            </font><font color="#5a5a5a">; total BMI mean of the whole network at the end of a tick</font><font color="#000000"><br />  ]<br />  </font><font color="#0000aa">tick</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">; tecnhical code resonsible for the whole model</font><font color="#000000"><br /></font><font color="#007f69">to</font><font color="#000000"> rewire-me </font><font color="#5a5a5a">; turtle procedure</font><font color="#000000"><br />  </font><font color="#5a5a5a">; node-A remains the same</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> node-A </font><font color="#660096">end1</font><font color="#000000"><br />  </font><font color="#5a5a5a">; as long as A is not connected to everybody</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> [ </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">link-neighbors</font><font color="#000000"> ] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">end1</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [<br />    </font><font color="#5a5a5a">; find a node distinct from A and not already a neighbor of &quot;A&quot;</font><font color="#000000"><br />    </font><font color="#0000aa">let</font><font color="#000000"> node-B </font><font color="#660096">one-of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [ (</font><font color="#660096">self</font><font color="#000000"> </font><font color="#660096">!=</font><font color="#000000"> node-A) </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">link-neighbor?</font><font color="#000000"> node-A) ]<br />    </font><font color="#5a5a5a">; wire the new edge</font><font color="#000000"><br />    </font><font color="#0000aa">ask</font><font color="#000000"> node-A [ </font><font color="#0000aa">create-link-with</font><font color="#000000"> node-B [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">cyan</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> rewired? </font><font color="#963700">true</font><font color="#000000"> ] ]<br /><br />    </font><font color="#0000aa">set</font><font color="#000000"> number-rewired number-rewired </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />    </font><font color="#0000aa">die</font><font color="#000000"> </font><font color="#5a5a5a">; remove the old edge</font><font color="#000000"><br />  ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> rewire-all<br />  </font><font color="#5a5a5a">; confirm we have the right amount of turtles, otherwise reinitialize</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">!=</font><font color="#000000"> num-nodes [ setup ]<br /><br />  </font><font color="#5a5a5a">; record which button was pushed</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> rewire-all? </font><font color="#963700">true</font><font color="#000000"><br /><br />  </font><font color="#5a5a5a">; we keep generating networks until we get a connected one since apl doesn't mean anything</font><font color="#000000"><br />  </font><font color="#5a5a5a">; in a non-connected network</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> connected? </font><font color="#963700">false</font><font color="#000000"><br />  </font><font color="#0000aa">while</font><font color="#000000"> [ </font><font color="#660096">not</font><font color="#000000"> connected? ] [<br />    </font><font color="#5a5a5a">; kill the old lattice and create new one</font><font color="#000000"><br />    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">links</font><font color="#000000"> [ </font><font color="#0000aa">die</font><font color="#000000"> ]<br />    wire-lattice<br />    </font><font color="#0000aa">set</font><font color="#000000"> number-rewired </font><font color="#963700">0</font><font color="#000000"><br /><br />    </font><font color="#5a5a5a">; ask each link to maybe rewire, according to the rewiring-probability slider</font><font color="#000000"><br />    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">links</font><font color="#000000"> [<br />      </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">&lt;</font><font color="#000000"> rewiring-probability [ rewire-me ]<br />    ]<br /><br />    </font><font color="#5a5a5a">; if the apl is infinity, it means our new network is not connected. Reset the lattice.</font><font color="#000000"><br />    </font><font color="#0000aa">ifelse</font><font color="#000000"> find-average-path-length </font><font color="#660096">=</font><font color="#000000"> infinity [ </font><font color="#0000aa">set</font><font color="#000000"> connected? </font><font color="#963700">false</font><font color="#000000"> ] [ </font><font color="#0000aa">set</font><font color="#000000"> connected? </font><font color="#963700">true</font><font color="#000000"> ]<br />  ]<br /><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> find-average-path-length<br /><br />  </font><font color="#0000aa">let</font><font color="#000000"> apl </font><font color="#963700">0</font><font color="#000000"><br /><br />  </font><font color="#5a5a5a">; calculate all the path-lengths for each node</font><font color="#000000"><br />  find-path-lengths<br /><br />  </font><font color="#0000aa">let</font><font color="#000000"> num-connected-pairs </font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">length</font><font color="#000000"> </font><font color="#660096">remove</font><font color="#000000"> infinity (</font><font color="#660096">remove</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> distance-from-other-turtles)] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"><br /><br />  </font><font color="#5a5a5a">; In a connected network on N nodes, we should have N(N-1) measurements of distances between pairs.</font><font color="#000000"><br />  </font><font color="#5a5a5a">; If there were any &quot;infinity&quot; length paths between nodes, then the network is disconnected.</font><font color="#000000"><br />  </font><font color="#0000aa">ifelse</font><font color="#000000"> num-connected-pairs </font><font color="#660096">!=</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)) [<br />    </font><font color="#5a5a5a">; This means the network is not connected, so we report infinity</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> apl infinity<br />  ][<br />    </font><font color="#0000aa">set</font><font color="#000000"> apl (</font><font color="#660096">sum</font><font color="#000000"> [</font><font color="#660096">sum</font><font color="#000000"> distance-from-other-turtles] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> (num-connected-pairs)<br />  ]<br /><br />  </font><font color="#0000aa">report</font><font color="#000000"> apl<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> find-path-lengths<br />  </font><font color="#5a5a5a">; reset the distance list</font><font color="#000000"><br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [<br />    </font><font color="#0000aa">set</font><font color="#000000"> distance-from-other-turtles []<br />  ]<br /><br />  </font><font color="#0000aa">let</font><font color="#000000"> i </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> j </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> k </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> node1 </font><font color="#660096">one-of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> node2 </font><font color="#660096">one-of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> node-count </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"><br />  </font><font color="#5a5a5a">; initialize the distance lists</font><font color="#000000"><br />  </font><font color="#0000aa">while</font><font color="#000000"> [i </font><font color="#660096">&lt;</font><font color="#000000"> node-count] [<br />    </font><font color="#0000aa">set</font><font color="#000000"> j </font><font color="#963700">0</font><font color="#000000"><br />    </font><font color="#0000aa">while</font><font color="#000000"> [ j </font><font color="#660096">&lt;</font><font color="#000000"> node-count ] [<br />      </font><font color="#0000aa">set</font><font color="#000000"> node1 </font><font color="#660096">turtle</font><font color="#000000"> i<br />      </font><font color="#0000aa">set</font><font color="#000000"> node2 </font><font color="#660096">turtle</font><font color="#000000"> j<br />      </font><font color="#5a5a5a">; zero from a node to itself</font><font color="#000000"><br />      </font><font color="#0000aa">ifelse</font><font color="#000000"> i </font><font color="#660096">=</font><font color="#000000"> j [<br />        </font><font color="#0000aa">ask</font><font color="#000000"> node1 [<br />          </font><font color="#0000aa">set</font><font color="#000000"> distance-from-other-turtles </font><font color="#660096">lput</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> distance-from-other-turtles<br />        ]<br />      ][<br />        </font><font color="#5a5a5a">; 1 from a node to it's neighbor</font><font color="#000000"><br />        </font><font color="#0000aa">ifelse</font><font color="#000000"> [ </font><font color="#660096">link-neighbor?</font><font color="#000000"> node1 ] </font><font color="#660096">of</font><font color="#000000"> node2 [<br />          </font><font color="#0000aa">ask</font><font color="#000000"> node1 [<br />            </font><font color="#0000aa">set</font><font color="#000000"> distance-from-other-turtles </font><font color="#660096">lput</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> distance-from-other-turtles<br />          ]<br />        ][ </font><font color="#5a5a5a">; infinite to everyone else</font><font color="#000000"><br />          </font><font color="#0000aa">ask</font><font color="#000000"> node1 [<br />            </font><font color="#0000aa">set</font><font color="#000000"> distance-from-other-turtles </font><font color="#660096">lput</font><font color="#000000"> infinity distance-from-other-turtles<br />          ]<br />        ]<br />      ]<br />      </font><font color="#0000aa">set</font><font color="#000000"> j j </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />    ]<br />    </font><font color="#0000aa">set</font><font color="#000000"> i i </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />  ]<br />  </font><font color="#0000aa">set</font><font color="#000000"> i </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> j </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> dummy </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">while</font><font color="#000000"> [k </font><font color="#660096">&lt;</font><font color="#000000"> node-count] [<br />    </font><font color="#0000aa">set</font><font color="#000000"> i </font><font color="#963700">0</font><font color="#000000"><br />    </font><font color="#0000aa">while</font><font color="#000000"> [i </font><font color="#660096">&lt;</font><font color="#000000"> node-count] [<br />      </font><font color="#0000aa">set</font><font color="#000000"> j </font><font color="#963700">0</font><font color="#000000"><br />      </font><font color="#0000aa">while</font><font color="#000000"> [j </font><font color="#660096">&lt;</font><font color="#000000"> node-count] [<br />        </font><font color="#5a5a5a">; alternate path length through kth node</font><font color="#000000"><br />        </font><font color="#0000aa">set</font><font color="#000000"> dummy ( (</font><font color="#660096">item</font><font color="#000000"> k [distance-from-other-turtles] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> i) </font><font color="#660096">+</font><font color="#000000"><br />                    (</font><font color="#660096">item</font><font color="#000000"> j [distance-from-other-turtles] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> k))<br />        </font><font color="#5a5a5a">; is the alternate path shorter?</font><font color="#000000"><br />        </font><font color="#0000aa">if</font><font color="#000000"> dummy </font><font color="#660096">&lt;</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> j [distance-from-other-turtles] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> i) [<br />          </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtle</font><font color="#000000"> i [<br />            </font><font color="#0000aa">set</font><font color="#000000"> distance-from-other-turtles </font><font color="#660096">replace-item</font><font color="#000000"> j distance-from-other-turtles dummy<br />          ]<br />        ]<br />        </font><font color="#0000aa">set</font><font color="#000000"> j j </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />      ]<br />      </font><font color="#0000aa">set</font><font color="#000000"> i i </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />    ]<br />    </font><font color="#0000aa">set</font><font color="#000000"> k k </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />  ]<br /><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">; creates a new lattice</font><font color="#000000"><br /></font><font color="#007f69">to</font><font color="#000000"> wire-lattice<br />  </font><font color="#5a5a5a">; iterate over the turtles</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> n </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">while</font><font color="#000000"> [ n </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> ] [<br />    </font><font color="#5a5a5a">; make edges with the next two neighbors</font><font color="#000000"><br />    </font><font color="#5a5a5a">; this makes a lattice with average degree of 4</font><font color="#000000"><br />    make-edge </font><font color="#660096">turtle</font><font color="#000000"> n<br />              </font><font color="#660096">turtle</font><font color="#000000"> ((n </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">)<br />              </font><font color="#963700">&quot;default&quot;</font><font color="#000000"><br />    </font><font color="#5a5a5a">; Make the neighbor's neighbor links curved</font><font color="#000000"><br />    make-edge </font><font color="#660096">turtle</font><font color="#000000"> n<br />              </font><font color="#660096">turtle</font><font color="#000000"> ((n </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">)<br />              </font><font color="#963700">&quot;curve&quot;</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> n n </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />  ]<br /><br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">link</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;curve-a&quot;</font><font color="#000000"> ]<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">link</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;curve-a&quot;</font><font color="#000000"> ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">; Connects two nodes</font><font color="#000000"><br /></font><font color="#007f69">to</font><font color="#000000"> make-edge [ node-A node-B the-shape ]<br />  </font><font color="#0000aa">ask</font><font color="#000000"> node-A [<br />    </font><font color="#0000aa">create-link-with</font><font color="#000000"> node-B  [<br />      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> the-shape<br />      </font><font color="#0000aa">set</font><font color="#000000"> rewired? </font><font color="#963700">false</font><font color="#000000"><br />    ]<br />  ]<br /></font><font color="#007f69">end</font>
</pre>
